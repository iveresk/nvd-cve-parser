# syntax=docker/dockerfile:1

# Alpine is chosen for its small footprint
# compared to Ubuntu
from golang:1.17-alpine

# Download necessary Go modules
WORKDIR app/
COPY go.mod ./
RUN go mod download

# COPY necessary files
ADD . ./
COPY *.go ./src/
COPY assets/*.json ./src/assets/
#Build stage RUN
RUN go build -o /gonmap

# Argument and ENV
ENV TARGET=${TARGET}

# Release stage
FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY assets/*.json ./src/assets/
COPY --from=0 /gonmap ./
CMD [ "/gonmap","-m","scanner","-p","23,80","-u",${TARGET} ]