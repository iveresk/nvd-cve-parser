package main

import (
	"flag"
	"log"
)

func main() {
	mode := flag.String("m", "", "Mode of the tool usage defining the algo of it.")
	flag.Parse()
	// Setting up the default mode usage for scanning network devices for CVEs
	// in a case that nothing was settled for the run
	if *mode == "" {
		*mode = "filljson"
	}
	// main algo is described here
	var devices Devices
	devices = readDevices()

	// chasing mode case to define the model of behavior and collection of API calls for JSON(s) update.
	switch *mode {
	case "filljson":
		// Filling our local JSON files with NVD Data
		// !NOTE, the DB is OLD and format changed dramatically, so not all JSON is Unmarshalled
		var json []byte
		for _, device := range devices.devices["devices"] {
			json = findKeyword(device)
			write := writeToFile(device, json)
			if write != nil {
				log.Fatal("Writing process has failed! Go frack your brain - its 2a.m. for the God's sake!")
			}
		}
		log.Println("The JSON files for the devices are successfully created")
	case "ndtocve":
		var gluedjson []NVDRequest
		// TODO the main algo here for the scanning network devices for CVEs
		for _, device := range devices.devices["devices"] {
			cvejson := readJSON(device)
			// Read JSON and Data collection methods for XLXS file are made not in an optimal form
			// for the file creation requiring lots of unnecessary actions.
			// It is made because of next more important operations for the libraries' assessment
			gluedjson = append(gluedjson, cvejson)
		}
		// Writing glued JSON to XLXS file
		err := writetoXLXS(gluedjson, devices)
		if err != nil {
			log.Println("Can not write to the XLXS file report")
			log.Println(err)
		}
	case "libtocve":
		// TODO the main algo here for the scanning code, imports for CVEs

	case "libtocwe":
		// TODO the main algo here for the scanning code, imports for CWEs
	case "update":
		// TODO update flow
	default:
		log.Fatal("Check your args, something went very wrong")
	}
}
